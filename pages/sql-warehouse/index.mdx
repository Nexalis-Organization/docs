# Nexalis-provided SQL Warehouse 

## Authentication Methods Overview

Nexalis provides all the required credentials to connect to the Databricks SQL Warehouse. Users do not generate or manage these themselves. Instead, Nexalis will securely share the connection details (hostname, HTTP path, and authentication values) according to the authentication method chosen.

To make it easier to decide which authentication method fits your situation:

- **Personal Access Token (PAT):** for scripts, quick tests, or one-time queries. Simplest option, not recommended for production.  
- **OAuth Machine-to-Machine (M2M):** for automated systems, pipelines, or CI/CD jobs. Secure and scalable for unattended workloads.  
- **OAuth User-to-Machine (U2M):** for analysts using BI tools such as Power BI, Tableau, or Grafana. Tokens refresh automatically.  

Your role as a user is simply to configure the credentials provided by Nexalis in your environment or BI application.

---

## Personal Access Token (PAT)

Nexalis will provide:

- `DATABRICKS_SERVER_HOSTNAME` — e.g., `adb-123456789012345.12.azuredatabricks.net`  
- `DATABRICKS_HTTP_PATH` — the endpoint path of the SQL warehouse  
- `DATABRICKS_TOKEN` — a PAT generated on your behalf  

Although easy to use, this method is not ideal for long-term production workflows.

---

## OAuth Machine-to-Machine (M2M)

Nexalis will provide:

- `DATABRICKS_HOST`  
- `DATABRICKS_CLIENT_ID`  
- `DATABRICKS_CLIENT_SECRET`  
- `DATABRICKS_TENANT_ID`  

These values are used to request an OAuth token for SQL warehouse access. Best for production automations.

---

## OAuth User-to-Machine (U2M)

For analysts or BI users. Nexalis provides:

- Workspace hostname  
- OAuth client app ID, scopes, and redirect details  

Users log in interactively, tokens refresh automatically.

---

## Tutorials for Connecting

### Python (Databricks SQL Connector)

```bash
pip install databricks-sql-connector
```

```python
from databricks import sql
import os

conn = sql.connect(
    server_hostname=os.getenv("DATABRICKS_SERVER_HOSTNAME"),
    http_path=os.getenv("DATABRICKS_HTTP_PATH"),
    access_token=os.getenv("DATABRICKS_TOKEN"),
)

with conn.cursor() as cur:
    cur.execute("SELECT * FROM my_catalog.my_schema.my_table LIMIT 10")
    for row in cur.fetchall():
        print(row)

conn.close()
```

For OAuth (M2M/U2M), the only difference is how the token is retrieved.

---

### Power BI

1. Open Power BI Desktop → **Get Data** → search **Databricks**  
2. Enter the Server Hostname and HTTP Path  
3. Choose authentication method:  
   - **OAuth2** (U2M)  
   - **Service Principal** (M2M)  
   - **Token** (PAT)  

⚠️ Some older versions of Power BI require the Databricks ODBC driver.

---

### Tableau

1. Go to **Connect to a Server → Databricks**  
2. Enter Server Hostname + HTTP Path  
3. Auth options:  
   - PAT → use `token` as username, PAT as password  
   - OAuth / Service Principal if provided  

⚠️ Tableau requires the Databricks ODBC driver.

---

### Excel (via ODBC)

1. Install the Databricks ODBC driver  
2. Configure DSN with Nexalis values:

```text
# PAT example
AuthMech=3; UID=token; PWD=&lt;PAT&gt;;

# OAuth M2M example
AuthMech=11; Auth_Flow=0; Auth_AccessToken=&lt;oauth-token&gt;;
```

3. In Excel → **Data → Get Data → From ODBC** → select DSN  

---

### Grafana

1. Add **Databricks** as a new data source  
2. Enter Server Hostname + HTTP Path  
3. Configure auth (PAT or OAuth)  
4. Query SQL tables and build dashboards  

⚠️ Heavy queries or sub-second streaming not ideal for Grafana.

---

